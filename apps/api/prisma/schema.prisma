generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// USERS
//
model User {
  id        String           @id @default(uuid())
  name      String
  email     String           @unique
  password  String
  role      UserRole         @default(STUDENT)

  progress  StudentProgress[]
  quiz      QuizSession[]

  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}

enum UserRole {
  ADMIN
  STUDENT
}

//
// CATEGORY
//
model Category {
  id        String             @id @default(uuid())
  name      String             @unique

  phases          Phase[]
  questions       Question[]
  lessons         Lesson[]
  studentProgress StudentProgress[]
  quizSessions    QuizSession[]
}

//
// PHASES
//
model Phase {
  id         String      @id @default(uuid())
  name       String
  order      Int
  categoryId String
  category   Category    @relation(fields: [categoryId], references: [id])

  questions  Question[]
  lessons    Lesson[]

  @@unique([categoryId, name])
}

//
// QUESTIONS
//
model Question {
  id         String     @id @default(uuid())
  statement  String
  optionA    String
  optionB    String
  optionC    String
  optionD    String
  correct    String

  order      Int        @default(0)

  categoryId String
  category   Category   @relation(fields: [categoryId], references: [id])

  phaseId    String?
  phase      Phase?     @relation(fields: [phaseId], references: [id])
}

//
// LESSONS
//
model Lesson {
  id         String     @id @default(uuid())
  title      String
  content    String

  order      Int        @default(0)

  categoryId String?
  category   Category?  @relation(fields: [categoryId], references: [id])

  phaseId    String?
  phase      Phase?     @relation(fields: [phaseId], references: [id])
}

//
// STUDENT PROGRESS
//
model StudentProgress {
  id         String    @id @default(uuid())
  userId     String
  user       User      @relation(fields: [userId], references: [id])

  categoryId String
  category   Category  @relation(fields: [categoryId], references: [id])

  correct    Int       @default(0)
  wrong      Int       @default(0)
  progress   Int       @default(0)

  updatedAt  DateTime  @updatedAt

  @@unique([userId, categoryId])
}

//
// QUIZ SESSION
//
model QuizSession {
  id         String    @id @default(uuid())
  userId     String
  user       User      @relation(fields: [userId], references: [id])

  categoryId String
  category   Category  @relation(fields: [categoryId], references: [id])

  total      Int
  correct    Int
  wrong      Int

  createdAt  DateTime  @default(now())
}
