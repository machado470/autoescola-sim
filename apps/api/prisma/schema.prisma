generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int       @id @default(autoincrement())
  email    String    @unique
  password String
  phases   UserPhaseProgress[]
  sessions ExamSession[]
}

model Phase {
  id        Int       @id @default(autoincrement())
  title     String
  order     Int
  questions Question[]
  progresses UserPhaseProgress[]
}

model Question {
  id        Int      @id @default(autoincrement())
  statement String
  image     String?
  category  String
  difficulty Int
  phaseId   Int?
  phase     Phase?   @relation(fields: [phaseId], references: [id])
  answers   Answer[]
}

model Answer {
  id         Int      @id @default(autoincrement())
  text       String
  correct    Boolean
  questionId Int
  question   Question @relation(fields: [questionId], references: [id])
}

model UserPhaseProgress {
  id       Int    @id @default(autoincrement())
  userId   Int
  user     User   @relation(fields: [userId], references: [id])
  phaseId  Int
  phase    Phase  @relation(fields: [phaseId], references: [id])
  progress Int    @default(0)
  done     Boolean @default(false)
}

model ExamSession {
  id       Int          @id @default(autoincrement())
  userId   Int
  user     User         @relation(fields: [userId], references: [id])
  startAt  DateTime     @default(now())
  endAt    DateTime?
  score    Int?
  answers  ExamAnswer[]
}

model ExamAnswer {
  id         Int         @id @default(autoincrement())
  questionId Int
  answerId   Int
  correct    Boolean
  sessionId  Int
  session    ExamSession @relation(fields: [sessionId], references: [id])
}
