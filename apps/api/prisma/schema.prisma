generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessions     ExamSession[]
  examAnswers  ExamAnswer[]
}

model Phase {
  id        Int      @id @default(autoincrement())
  name      String
  order     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  questions Question[]
  sessions  ExamSession[]
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String
  icon      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  questions Question[]
}

model Question {
  id        Int      @id @default(autoincrement())
  statement String
  image     String?
  respostaA String
  respostaB String
  respostaC String
  respostaD String
  correta   String

  phaseId    Int
  categoryId Int

  phase    Phase     @relation(fields: [phaseId], references: [id])
  category Category  @relation(fields: [categoryId], references: [id])
  answers  ExamAnswer[]
}

model ExamSession {
  id         Int          @id @default(autoincrement())
  userId     Int
  phaseId    Int
  startedAt  DateTime     @default(now())
  finishedAt DateTime?

  user   User        @relation(fields: [userId], references: [id])
  phase  Phase       @relation(fields: [phaseId], references: [id])
  answers ExamAnswer[]
}

model ExamAnswer {
  id         Int      @id @default(autoincrement())
  sessionId  Int
  questionId Int
  answerId   Int
  userId     Int

  session  ExamSession @relation(fields: [sessionId], references: [id])
  question Question     @relation(fields: [questionId], references: [id])
  user     User         @relation(fields: [userId], references: [id])
}
