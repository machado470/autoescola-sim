generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////
// CATEGORY
//////////////////////

model Category {
  id        Int       @id @default(autoincrement())
nano apps/api/prisma/schema.prisma
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  phases     Phase[]
  questions  Question[]
  progress   UserProgress[]
}

//////////////////////
// PHASE
//////////////////////

model Phase {
  id        Int       @id @default(autoincrement())
  name      String
  order     Int
  category  Category  @relation(fields: [categoryId], references: [id])
  categoryId Int

  questions Question[]
  progress  UserProgress[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([categoryId, name])
}

//////////////////////
// QUESTION
//////////////////////

model Question {
  id        Int      @id @default(autoincrement())
  statement String
  answerA   String
  answerB   String
  answerC   String
  answerD   String
  correct   String
  image     String?

  phase      Phase    @relation(fields: [phaseId], references: [id])
  phaseId    Int

  category   Category @relation(fields: [categoryId], references: [id])
  categoryId Int

  answers    ExamAnswer[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}


//////////////////////
// EXAM SESSION
//////////////////////

model ExamSession {
  id        Int          @id @default(autoincrement())
  user      User         @relation(fields: [userId], references: [id])
  userId    Int

  startedAt DateTime     @default(now())
  finishedAt DateTime?
  score     Int          @default(0)

  answers   ExamAnswer[]
}

//////////////////////
// EXAM ANSWER
//////////////////////

model ExamAnswer {
  id         Int          @id @default(autoincrement())
  session    ExamSession  @relation(fields: [sessionId], references: [id])
  sessionId  Int

  question   Question     @relation(fields: [questionId], references: [id])
  questionId Int

  user       User         @relation(fields: [userId], references: [id])
  userId     Int

  chosen     String
  isCorrect  Boolean      @default(false)

  createdAt  DateTime     @default(now())
}


//////////////////////
// USER
//////////////////////

model User {
  id        Int            @id @default(autoincrement())
  email     String         @unique
  password  String
  name      String?

  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  examSessions ExamSession[]
  examAnswers  ExamAnswer[]
  progress     UserProgress[]
}

//////////////////////
// USER PROGRESS
//////////////////////

model UserProgress {
  id         Int       @id @default(autoincrement())
  user       User      @relation(fields: [userId], references: [id])
  userId     Int

  category   Category  @relation(fields: [categoryId], references: [id])
  categoryId Int

  phase      Phase     @relation(fields: [phaseId], references: [id])
  phaseId    Int

  correct    Int       @default(0)
  total      Int       @default(0)

  startedAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@unique([userId, categoryId, phaseId])
}

