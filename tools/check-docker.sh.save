#!/bin/bash
# -----------------------------------------
# Verifica containers do projeto AutoEscola-Sim
# -----------------------------------------

echo "üîç Checando containers ativos..."
POSTGRES_STATUS=$(docker inspect -f '{{.State.Health.Status}}' autoescola_postgres 2>/dev/null)
PGADMIN_STATUS=$(docker inspect -f '{{.State.Health.Status}}' autoescola_pgadmin 2>/dev/null)

if [ -z "$POSTGRES_STATUS" ]; then
  echo "‚ö†Ô∏è  Postgres n√£o encontrado. Subindo containers..."
  docker compose up -d
  exit 0
fi

if [ "$POSTGRES_STATUS" != "healthy" ]; then
  echo "‚ö†Ô∏è  Postgres n√£o est√° saud√°vel (status: $POSTGRES_STATUS). Reiniciando..."
  docker restart autoescola_postgres
fi

if [ "$PGADMIN_STATUS" != "healthy" ] && [ "$PGADMIN_STATUS" != "starting" ]; then
  echo "‚ö†Ô∏è  PgAdmin n√£o est√° saud√°vel (status: $PGADMIN_STATUS). Reiniciando..."
  docker restart autoescola_pgadmin
fi

echo "‚úÖ Containers est√£o rodando normalmente!"
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

